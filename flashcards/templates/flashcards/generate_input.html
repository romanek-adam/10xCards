{% extends "base.html" %}

{% load static i18n %}

{% block title %}
  Generate Flashcards - 10xCards
{% endblock title %}
{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-8 mx-auto">
        <!-- Page Header -->
        <div class="mb-4">
          <h1>{% translate "Generate Flashcards" %}</h1>
          <p class="text-muted">Paste your study material below and we'll generate 5-10 flashcards using AI.</p>
        </div>
        <!-- Error Alert (displayed on generation failure) -->
        {% if form.non_field_errors %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ form.non_field_errors.0 }}
            <button type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                    aria-label="Close"></button>
          </div>
        {% endif %}
        <!-- Input Form -->
        <form method="post" id="generate-form">
          {% csrf_token %}
          <div class="mb-3">
            <label for="{{ form.input_text.id_for_label }}" class="form-label">{% translate "Study Material" %}</label>
            {{ form.input_text }}
            {% if form.input_text.help_text %}<div class="form-text">{{ form.input_text.help_text }}</div>{% endif %}
            {% if form.input_text.errors %}<div class="invalid-feedback d-block">{{ form.input_text.errors.0 }}</div>{% endif %}
          </div>
          <!-- Submit Button -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-success btn-lg" id="generate-btn">{% translate "Generate Flashcards" %}</button>
          </div>
        </form>
        <!-- Back to My Flashcards -->
        <div class="mt-3">
          <a href="{% url 'core:flashcard-list' %}" class="btn btn-link">{% translate "‚Üê Back to My Flashcards" %}</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Loading Overlay (shown during AI generation) -->
  <div id="loading-overlay"
       class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
       style="background-color: rgba(0, 0, 0, 0.5);
              z-index: 9999;
              display: none !important">
    <div class="bg-white p-4 rounded shadow text-center">
      <div class="spinner-border text-success mb-3"
           role="status"
           style="width: 3rem;
                  height: 3rem">
        <span class="visually-hidden">{% translate "Loading..." %}</span>
      </div>
      <p class="mb-0">
        {% translate "Generating flashcards..." %}
        <br />
        <small class="text-muted">{% translate "This may take up to 30 seconds" %}</small>
      </p>
    </div>
  </div>
{% endblock content %}
{% block javascript %}
  {{ block.super }}
  <script>
    // Show loading overlay on form submit
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('generate-form');
      const loadingOverlay = document.getElementById('loading-overlay');
      const submitBtn = document.getElementById('generate-btn');

      if (form && loadingOverlay && submitBtn) {
        form.addEventListener('submit', function() {
          loadingOverlay.style.display = 'flex';
          submitBtn.disabled = true;
        });
      }
    });
  </script>
{% endblock javascript %}
